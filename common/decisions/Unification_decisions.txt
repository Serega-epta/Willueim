@unification_start_date = 2200.1.1 #2027.1.1
Unification_campaign = {
	peaceful_unification_campaign = {
		target_root_trigger = {
			#visible doesn`t disable available trigger
			hidden_trigger = {
				has_country_flag = Unification_campaign_flag
			}
		}
		target_array = neighbors_owned
		target_trigger = {
			FROM = {
				NOT = {
					has_war_with = ROOT
					tag = SIL #TODO
					tag = LWV #TODO
					has_country_flag = anschluss_denied_@ROOT
				}
				has_government = ROOT
				fighting_army_strength_ratio = {
					tag = ROOT
					ratio < 0.5
				}
				unification_campaign_allowed = yes
			}
		}
		cost = 50
		days_remove = 30
		remove_effect = {
			FROM = {
				country_event = {
					id = unification_negotiations.1
				}
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 50
		}
	}
	ultimatum_campaign = {
		target_root_trigger = {
			#visible doesn`t disable available trigger
			hidden_trigger = {
				has_country_flag = Unification_campaign_flag
			}
		}
		target_array = neighbors_owned
		target_trigger = {
			FROM = {
				fighting_army_strength_ratio = {
					tag = ROOT
					ratio < 0.5
				}
				NOT = {
					has_war_with = ROOT
					tag = SIL #TODO
					tag = LWV #TODO
				}
				OR = {
					NOT = {
						has_government = ROOT
					}
					has_country_flag = anschluss_denied_@ROOT
				}
				unification_campaign_allowed = yes
			}
		}
		cost = 75
		war_with_on_remove = FROM
		days_remove = 20
		complete_effect = {
			#prepare for war
			hidden_effect = {
				add_ai_strategy = {
					type = prepare_for_war
					id = FROM
					value = 200
				}
				FROM = {
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = 200
					}
				}
			}
		}
		remove_effect = {
			declare_war_on = {
				target = FROM
				type = annex_everything
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 10
			modifier = {
				FROM = {
					has_war = yes
				}
				factor = 2
			}
			modifier = {
				OR = {
					check_variable = {
						#just prevent batle royal
						random < 0.996
					}
					has_war = yes
					has_decision = ultimatum_campaign
				}
				factor = 0
			}
		}
	}



    Finnish_Unification_campaign = {
		available = {
			all_other_country = {
				OR = {
					tag = BLS
					is_subject_of = ROOT
				}
			}
		}
		cost = 100
		fire_only_once = yes
		complete_effect = {
			set_country_flag = Unification_flag
			remove_ideas = Time_goes_by
			add_dynamic_modifier = {
				modifier = Motherland_Then_now_henceforth
			}
			set_variable = {
    			var = monthly_population_var
    			value = -0.9
			}
			set_variable = {
    			var = production_speed_industrial_complex_factor_var
    			value = 0.5
			}
			set_variable = {
    			var = production_speed_infrastructure_factor_var
    			value = 0.5
			}
			set_variable = {
    			var = required_garrison_factor_var
    			value = -0.7
			}
			set_variable = {
    			var = weekly_manpower_var
    			value = -1000
			}
			set_variable = {
    			var = compliance_growth_on_our_occupied_states_var
    			value = 0.6
			}
			set_variable = {
    			var = red_forest_expiditions
    			value = 1
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
			#but... if there is 2027 - we should hurry (unification)
			modifier = {
				date > @unification_start_date
				add = 1000
			}
		}
	}
}

Unification = {
	city_restoration = {
		targets = {
			219		#Moscow
			249		#Kazan
			1001	#Ufa
		}
		available = {
			#num_of_civilian_factories_available_for_projects > 19
			#controls_state = FROM
			FROM = {
				#filtration_station > 0
			}
		}
		target_root_trigger = {
			#has_country_flag = Unification_flag
		}
		target_trigger = {
			FROM = {
				NOT = {
					has_state_flag = city_restored
				}
			}
		}
		state_target = yes
		cost = 120
		days_remove = 1
		modifier = {
			civilian_factory_use = 20
		}
		remove_effect = {
			FROM = {
				#if for tooltip
				if = {
					limit = {
						state = 219 #Москва
						is_capital = no
					}
					ROOT = {
						set_capital = {
							state = PREV
						}
					}
				}
				if = {
					limit = {
						infrastructure < 5
					}
					set_building_level = {
						type = infrastructure
						level = 5
						instant_build = yes
					}
				}
				custom_override_tooltip = {
					tooltip = unlock_all_building_slots_tt
					add_extra_state_shared_building_slots = 25
				}
				custom_override_tooltip = {
					tooltip = repair_all_shared_buildings_tt
					fix_all_shared_building = yes
				}
				add_dynamic_modifier = {
					modifier = city_restored
					days = 180
				}
				set_state_flag = city_restored
			}
			add_to_array = {
				city_restored_array = FROM
			}
			unite_motherland = yes
		}
	}
	communication_restoration = {
		targets = {
			219
		}
		available = {
			num_of_civilian_factories_available_for_projects > 9
			controls_state = FROM
			radar_station > 0
		}
		target_root_trigger = {
			#has_country_flag = Unification_flag
		}
		target_trigger = {
			FROM = {
				NOT = {
					has_state_flag = communication_restored
				}
			}
		}
		state_target = yes
		cost = 25
		days_remove = 20
		modifier = {
			civilian_factory_use = 10
		}
		remove_effect = {
			FROM = {
				set_state_flag = communication_restored
				add_building_construction = {
					type = radar_station
    				level = 3
    				instant_build = yes
				}
			}
			add_to_array = {
				communication_restored_array = FROM
			}
			unite_motherland = yes
		}
	}
	city_garrison = {
		targets = {
			219	#Moscow
		}
		state_target = yes
		available = {
			controls_state = FROM
			set_temp_variable = {
				div_num = FROM.state_population_k
			}
			multiply_temp_variable = {
				div_num = 0.025
			}
			#divisions_in_state can`t accept temp variable in size
			meta_trigger = {
				text = {
					divisions_in_state = {
						size > [N]
						state = FROM
					}
				}
				N = "[?div_num]"
			}
		}
		target_root_trigger = {
			#has_country_flag = Unification_flag
		}
		target_trigger = {
			FROM = {
				#no need for guarding ruins
				#has_state_flag = city_restored
				NOT = {
					has_state_flag = city_garrison_set
				}
			}
		}
		cost = 25
		days_remove = 20
		modifier = {
			production_factory_max_efficiency_factor = -0.1
		}
		remove_effect = {
			FROM = {
				set_state_flag = city_garrison_set
			}
			add_to_array = {
				city_garrison_array = FROM
			}
			unite_motherland = yes
		}
	}
	#Special for Leningrade
	operation_nevsky = {
		targets = { 195 }
		state_target = yes
		fire_only_once = yes
		cost = 250
		days_remove = 2
		available = {
			#custom_trigger_tooltip = {
			#	tooltip = cities_restored_num_3_or_bigger_tt
			#	check_variable = {
			#		city_restored_array^num > 2
			#	}
			#}
			#num_of_civilian_factories_available_for_projects > 49
		}
		target_root_trigger = {
			#has_country_flag = Unification_flag
		}
		modifier = {
			civilian_factory_use = 50
		}
		remove_effect = {
			FROM = {
				custom_override_tooltip = {
					tooltip = {
						localization_key = city_resettlement_tt
						NUM = 50000
					}
					for_each_scope_loop = {
						array = ROOT.city_restored_array
						add_manpower = -50000
						PREV = {
							add_manpower = 50000
						}
					}
				}
				if = {
					limit = {
						infrastructure < 5
					}
					set_building_level = {
						type = infrastructure
						level = 5
						instant_build = yes
					}
				}
				custom_override_tooltip = {
					tooltip = unlock_all_building_slots_tt
					add_extra_state_shared_building_slots = 25
				}
				custom_override_tooltip = {
					tooltip = repair_all_shared_buildings_tt
					fix_all_shared_building = yes
				}
				add_dynamic_modifier = {
					modifier = city_restored
					days = 180
				}
				set_state_flag = city_restored
			}
			add_to_array = {
				city_restored_array = FROM
			}
			unite_motherland = yes
		}
	}
	reanimate_civil_industry = {
		fire_only_once = yes
		cost = 500
		days_remove = 360
		available = {
			#has_country_flag = Unification_flag
			#num_of_civilian_factories_available_for_projects > 49
		}
		modifier = {
			civilian_factory_use = 50
		}
		remove_effect = {
			every_controlled_state = {
				limit = {
					building_level@industrial_complex < 1
				}
				add_extra_state_shared_building_slots = 1
				add_building_construction = {
					type = industrial_complex
					level = 1
					instant_build = yes
				}
				if = {
					limit = {
						check_variable = {
							building_level@infrastructure < 1
						}
					}
					add_building_construction = {
						type = infrastructure
						level = 1
						instant_build = yes
					}
				}
			}
			set_country_flag = civil_industry_reanimate
			unite_motherland = yes
		}
	}
	water_purification = {
		fire_only_once = yes
		cost = 500
		days_remove = 360
		available = {
			#has_country_flag = Unification_flag
			#num_of_civilian_factories_available_for_projects > 49
		}
		modifier = {
			civilian_factory_use = 50
		}
		remove_effect = {
			set_country_flag = water_purification
			unite_motherland = yes
		}
	}
	new_railways = {
		fire_only_once = yes
		cost = 500
		days_remove = 360
		available = {
			#has_country_flag = Unification_flag
			#num_of_civilian_factories_available_for_projects > 49
			custom_trigger_tooltip = {
				tooltip = city_restored_at_least_2_tt
				check_variable = {
					city_restored_array^num > 1
				}
			}
		}
		modifier = {
			civilian_factory_use = 50
		}
		remove_effect = {
			if = {
				limit = {
					195 = {
						has_state_flag = city_restored
					}
					219 = {
						has_state_flag = city_restored
					}
					can_build_railway = {
						start_state = 195
    					target_state = 219
					}
				}
				build_railway = {
					level = 1
					start_state = 195
    				target_state = 219
				}
			}
			set_country_flag = new_railways
			unite_motherland = yes
		}
	}



}
reunification_category = {

    Restore_communications = {
		available = {
			has_railway_connection = {
				start_province = 6380
				target_province = 1278
			}
			has_railway_connection = {
				start_province = 6380
				target_province = 11670
			}
			has_railway_connection = {
				start_province = 6380
				target_province = 13350
			}
			has_railway_connection = {
				start_province = 6380
				target_province = 3335
			}
			has_railway_connection = {
				start_province = 6380
				target_province = 9355
			}
			has_railway_connection = {
				start_province = 6380
				target_province = 9417
			}
			has_railway_connection = {
				start_province = 6380
				target_province = 9340
			}
			has_railway_connection = {
				start_province = 6380
				target_province = 3338
			}
		}
		cost = 100
		fire_only_once = yes
		complete_effect = {
			custom_effect_tooltip = Restore_communications_tt
			add_to_variable = {
    			var = weekly_manpower_var
    			value = 300
			}
			add_to_variable = {
    			var = monthly_population_var
    			value = 0.2
			}
			subtract_from_variable = {
    			var = production_speed_infrastructure_factor_var
    			value = 0.5
			}
			set_country_flag = Restore_communications_flag
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

    Distribute_production = {
		available = {
			
		}
		cost = 0
		fire_only_once = yes
		days_remove = 120
		complete_effect = {
			set_variable = {
				var = num_of_industrial_complex_var
				value = num_of_factories
			}
			multiply_variable = {
    			var = num_of_industrial_complex_var
    			value = 0.7
			}
			every_owned_state = {
				limit = {
					num_of_industrial_complex > 0
				}
				random_select_amount = num_of_industrial_complex_var
				remove_building = {
					type = industrial_complex
					level = 1
				}
			}
		}
		remove_effect = {
			every_owned_state = {
				random_select_amount = num_of_industrial_complex_var
				add_building_construction = {
					type = industrial_complex
					level = 1
				}
			}
			custom_effect_tooltip = Distribute_production_tt
			add_to_variable = {
    			var = weekly_manpower_var
    			value = 200
			}
			add_to_variable = {
    			var = monthly_population_var
    			value = 0.3
			}
			subtract_from_variable = {
    			var = production_speed_industrial_complex_factor_var
    			value = 0.5
			}
			set_country_flag = Distribute_production_flag
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

    Creation_of_garrisons = {
		visible = {
			NOT = {
				has_idea = Garrisons
			}
		}
		available = {
			custom_trigger_tooltip = {
				tooltip = garrisons_tt
				num_divisions_in_states = {
					count > 60
					states = { 1001 249 957 219 214 195 808 763 891 839 221 242}
				}
			}
		}
		cost = 100
		complete_effect = {
			add_ideas = Garrisons
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

    Restoration_of_Moscow = {
		available = {
			
		}
		cost = 100
		days_remove = 90
		fire_only_once = yes
		complete_effect = {
			
		}
		remove_effect = {
			219 = {
				add_building_construction = {
    				type = infrastructure
    				level = 1
    				instant_build = yes
				}
				add_building_construction = {
    				type = supply_node
    				level = 1
    				instant_build = yes
					province = 6380
				}
				add_core_of = ROOT
				add_dynamic_modifier = {
    				modifier = Restoration_of_Moscow_modifier
				}
			}
			set_capital = {state = 219}
			set_country_flag = Restoration_of_Moscow_flag
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

    Fresh_water_purification = {
		available = {
			filtration_station > 9
		}
		cost = 50
		fire_only_once = yes
		complete_effect = {
			custom_effect_tooltip = Fresh_water_purification_tt
			add_to_variable = {
    			var = monthly_population_var
    			value = 0.4
			}
			set_country_flag = Fresh_water_purification_flag
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

    Clear_the_red_forests_north = {
		available = {
			has_manpower > 999
			has_equipment = {
				suit_equipment > 999
			}
			has_equipment = {
				gardener_equipment > 19
			}
		}
		cost = 100
		days_remove = 50
		fire_only_once = yes
		complete_effect = {
			add_manpower = -1000
			add_equipment_to_stockpile = {
				type = suit_equipment
				amount = -1000
			}
			add_equipment_to_stockpile = {
				type = gardener_equipment
				amount = -20
			}
		}
		remove_effect = {
			add_stability = 0.1
			custom_effect_tooltip = Clear_the_red_forests_tt
			add_to_variable = {
    			var = production_speed_buildings_factor_var
    			value = 0.02
			}
			add_to_variable = {
    			var = red_forest_expiditions
    			value = 1
			}		
			IF = {
				limit = {
					check_variable = {
						red_forest_expiditions = 5
					}
				}
				add_to_variable = {
    				var = weekly_manpower_var
    				value = 2000
				}
				clr_country_flag = integration_block
				set_country_flag = Clear_the_red_forests_flag
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

	Clear_the_red_forests_south = {
		available = {
			has_manpower > 999
			has_equipment = {
				suit_equipment > 999
			}
			has_equipment = {
				gardener_equipment > 19
			}
		}
		cost = 100
		days_remove = 50
		fire_only_once = yes
		complete_effect = {
			add_manpower = -1000
			add_equipment_to_stockpile = {
				type = suit_equipment
				amount = -1000
			}
			add_equipment_to_stockpile = {
				type = gardener_equipment
				amount = -20
			}
		}
		remove_effect = {
			add_stability = 0.1
			custom_effect_tooltip = Clear_the_red_forests_tt
			add_to_variable = {
    			var = production_speed_buildings_factor_var
    			value = 0.02
			}
			add_to_variable = {
    			var = red_forest_expiditions
    			value = 1
			}			
			IF = {
				limit = {
					check_variable = {
						red_forest_expiditions = 5
					}
				}
				add_to_variable = {
    				var = weekly_manpower_var
    				value = 2000
				}
				clr_country_flag = integration_block
				set_country_flag = Clear_the_red_forests_flag
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

	Clear_the_red_forests_west = {
		available = {
			has_manpower > 999
			has_equipment = {
				suit_equipment > 999
			}
			has_equipment = {
				gardener_equipment > 19
			}
		}
		cost = 100
		days_remove = 50
		fire_only_once = yes
		complete_effect = {
			add_manpower = -1000
			add_equipment_to_stockpile = {
				type = suit_equipment
				amount = -1000
			}
			add_equipment_to_stockpile = {
				type = gardener_equipment
				amount = -20
			}
		}
		remove_effect = {
			add_stability = 0.1
			custom_effect_tooltip = Clear_the_red_forests_tt
			add_to_variable = {
    			var = production_speed_buildings_factor_var
    			value = 0.02
			}
			add_to_variable = {
    			var = red_forest_expiditions
    			value = 1
			}			
			IF = {
				limit = {
					check_variable = {
						red_forest_expiditions = 5
					}
				}
				add_to_variable = {
    				var = weekly_manpower_var
    				value = 2000
				}
				clr_country_flag = integration_block
				set_country_flag = Clear_the_red_forests_flag
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

	Clear_the_red_forests_east = {
		available = {
			has_manpower > 999
			has_equipment = {
				suit_equipment > 999
			}
			has_equipment = {
				gardener_equipment > 19
			}
		}
		cost = 100
		days_remove = 50
		fire_only_once = yes
		complete_effect = {
			add_manpower = -1000
			add_equipment_to_stockpile = {
				type = suit_equipment
				amount = -1000
			}
			add_equipment_to_stockpile = {
				type = gardener_equipment
				amount = -20
			}
		}
		remove_effect = {
			add_stability = 0.1
			custom_effect_tooltip = Clear_the_red_forests_tt
			add_to_variable = {
    			var = production_speed_buildings_factor_var
    			value = 0.02
			}
			add_to_variable = {
    			var = red_forest_expiditions
    			value = 1
			}			
			IF = {
				limit = {
					check_variable = {
						red_forest_expiditions = 5
					}
				}
				add_to_variable = {
    				var = weekly_manpower_var
    				value = 2000
				}
				clr_country_flag = integration_block
				set_country_flag = Clear_the_red_forests_flag
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}

	Clear_the_red_forests_center = {
		available = {
			has_manpower > 999
			has_equipment = {
				suit_equipment > 999
			}
			has_equipment = {
				gardener_equipment > 19
			}
		}
		cost = 100
		days_remove = 50
		fire_only_once = yes
		complete_effect = {
			add_manpower = -1000
			add_equipment_to_stockpile = {
				type = suit_equipment
				amount = -1000
			}
			add_equipment_to_stockpile = {
				type = gardener_equipment
				amount = -20
			}
		}
		remove_effect = {
			add_stability = 0.1
			custom_effect_tooltip = Clear_the_red_forests_tt
			add_to_variable = {
    			var = production_speed_buildings_factor_var
    			value = 0.02
			}
			add_to_variable = {
    			var = red_forest_expiditions
    			value = 1
			}			
			IF = {
				limit = {
					check_variable = {
						red_forest_expiditions = 5
					}
				}
				add_to_variable = {
    				var = weekly_manpower_var
    				value = 2000
				}
				clr_country_flag = integration_block
				set_country_flag = Clear_the_red_forests_flag
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}
	

    Operation_Nevsky = {
		available = {
			
		}
		cost = 100
		days_remove = 120
		fire_only_once = yes
		remove_effect = {
			custom_effect_tooltip = Operation_Nevsky_tt
			add_to_variable = {
    			var = monthly_population_var
    			value = 0.6
			}
			add_to_variable = {
    			var = production_speed_buildings_factor_var
    			value = 0.2
			}
			set_country_flag = Operation_Nevsky_flag
			195 = {
				add_building_construction = {
    				type = infrastructure
    				level = 1
    				instant_build = yes
				}
				add_building_construction = {
    				type = supply_node
    				level = 1
    				instant_build = yes
					province = 3151
				}
				add_manpower = 1000000
			}
			1001 = {
				add_manpower = -100000
			}
			1002 = {
				add_manpower = -100000
			}
			398 = {
				add_manpower = -100000
			}
			399 = {
				add_manpower = -100000
			}
			954 = {
				add_manpower = -100000
			}
			996 = {
				add_manpower = -100000
			}
			249 = {
				add_manpower = -100000
			}
			251 = {
				add_manpower = -100000
			}
			833 = {
				add_manpower = -100000
			}
			729 = {
				add_manpower = -50000
			}
			651 = {
				add_manpower = -50000
			}
		}
		ai_will_do = {
			#bots will follow the scenario
			base = 0
		}
	}
}
red_forest_category = {
	clear_red_forest = {
		target_array = core_states
		state_target = yes
	}
}