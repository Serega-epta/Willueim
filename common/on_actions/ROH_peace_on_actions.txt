on_actions = {
	on_capitulation = {
		effect = {
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_capitulation"
			
			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			}
			ROOT = {
				save_global_event_target_as = losing_country
			}

			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"
			
			add_to_variable = { global.peace_popup_dirty = 1 }

			if = {
				limit = {
					OR = {
						ROOT = {
							original_tag = MOT
						}
						ROOT = {
							original_tag = URA
						}
						ROOT = {
							original_tag = EDM
						}
						ROOT = {
							original_tag = URC
						}
						ROOT = {
							original_tag = WPK
						}
						ROOT = {
							original_tag = ZAN
						}
						ROOT = {
							original_tag = OCH
						}
						ROOT = {
							original_tag = TAR
						}
					}
					FROM = {
						original_tag = GLS
					}
					GLS = { has_country_flag = GLS_negotiation_process_fail }
				}

				every_country = {
					limit = { has_war_with = GLS }
					white_peace = GLS
				}
				
				FROM = {
					annex_country = {
						target = MOT
						transfer_troops = no
					}
					annex_country = {
						target = URA
						transfer_troops = no
					}
					annex_country = {
						target = EDM
						transfer_troops = no
					}
					annex_country = {
						target = URC
						transfer_troops = no
					}
					annex_country = {
						target = WPK
						transfer_troops = no
					}
					annex_country = {
						target = ZAN
						transfer_troops = no
					}
					annex_country = {
						target = OCH
						transfer_troops = no
					}
					annex_country = {
						target = TAR
						transfer_troops = no
					}
					every_state = {
						remove_core_of = ROOT
					}
					clr_country_flag = GLS_negotiation_process_fail
				}
				set_global_flag = skip_default_capitulation
			}

			else_if = {
				limit = {
					OR = {
						ROOT = { is_in_faction = no }
						ROOT = {
							all_allied_country = {
								has_capitulated = yes
							}
						}
					}
				}
				log = "war_won"
				set_global_flag = war_won
				
				if = {
					limit = { NOT = { has_global_flag = skip_default_capitulation } }
					log = "Default Capitulation"
					FROM = {
						every_enemy_country = {
							limit = {
								OR = {
									original_tag = ROOT
									is_in_faction_with = ROOT
									is_puppet_of = ROOT
								}
							}
							FROM = {
								white_peace = PREV
								annex_country = {
									target = PREV
									transfer_troops = no
								}
								every_state = {
									remove_core_of = ROOT
								}
							}
						}
					}
				}				
			}
			clr_global_flag = skip_default_capitulation
		}
	}
}